version: "3"

services:
  bitcoind:
    container_name: bitcoind
    restart: always
    image: btcpayserver/bitcoin:24.0.1-1
    expose:
      - 18443
      - 18444
      - 18445
      - 8332
      - 28334
      - 28335
      - 28336
    environment:
      BITCOIN_NETWORK: regtest
      BITCOIN_EXTRA_ARGS: |
        server=1
        debug=1
        rpcbind=bitcoind
        rpcport=18443
        rpcauth=foo:7d9ba5ae63c3d4dc30583ff4fe65a67e$$9e3634e81c11659e3de036d0bf88f89cd169c1039e6e09607562d54765c649cc
        rpcallowip=0.0.0.0/0
        zmqpubrawblock=tcp://0.0.0.0:28334
        zmqpubrawtx=tcp://0.0.0.0:28335
        zmqpubhashblock=tcp://0.0.0.0:28336
    networks:
      lightningd_network:
        ipv4_address: 10.5.0.2

  lightningd:
    container_name: lightningd
    restart: always
    build: 
      context: ./src/context
      dockerfile: lightningd

    volumes:
      - ~/.docker/volumes/lightningd_data/:/root/.lightning/regtest:rw
    networks:
      lightningd_network:
        ipv4_address: 10.5.0.5

  lnd:
    container_name: lnd
    restart: always
    build: 
      context: ./src/context
      dockerfile: lnd
    
    volumes:
      - ~/.docker/volumes/lnd_data/:/shared/

    networks:
      lightningd_network:
        ipv4_address: 10.5.0.6
  
  lnd_2:
    container_name: lnd_2
    restart: always
    build: 
      context: ./src/context
      dockerfile: lnd
    
    volumes:
      - ~/.docker/volumes/lnd_data2/:/shared/

    networks:
      lightningd_network:
        ipv4_address: 10.5.0.7

  # docker pull 


volumes:
  lightningd_data:
  lnd_data:

networks:
  lightningd_network:
    driver: bridge
    ipam:
      config:
        - subnet: 10.5.0.0/16

  #  lnd
  # --noseedbackup
  # --trickledelay=5000
  # --alias={{name}}
  # --externalip={{name}}
  # --tlsextradomain={{name}}
  # --tlsextradomain={{containerName}}
  # --listen=0.0.0.0:9735
  # --rpclisten=0.0.0.0:10009
  # --restlisten=0.0.0.0:8080
  # --bitcoin.active
  # --bitcoin.regtest
  # --bitcoin.node=bitcoind
  # --bitcoind.rpchost={{backendName}}
  # --bitcoind.rpcuser={{rpcUser}}
  # --bitcoind.rpcpass={{rpcPass}}
  # --bitcoind.zmqpubrawblock=tcp://{{backendName}}:28334
  # --bitcoind.zmqpubrawtx=tcp://{{backendName}}:28335